# InterSystems Web Gateway (CSP) module load
LoadModule csp_module_sa "/opt/webgateway/bin/CSPa24.so"

# Paths required by the Web Gateway
CSPModulePath "/opt/webgateway/bin/"
CSPConfigPath "/opt/webgateway/bin/"

# Allow Apache to load/use the Web Gateway binaries
<Directory "/opt/webgateway/bin">
    AllowOverride None
    Options MultiViews FollowSymLinks ExecCGI
    Require all granted

    <FilesMatch "\.(log|ini|pid|exe)$">
        Require all denied
    </FilesMatch>
</Directory>

# ---- Route requests to IRIS via Web Gateway ----
# NOTE: Keep CSP directives at server level (NOT inside <VirtualHost>),
# per the warning you saw: only supported at default server level.

# Handle CSP apps + REST + management paths
<LocationMatch "^/(csp|api|isc)(/|$)">
    CSP On
</LocationMatch>

# If you have other apps mounted elsewhere, add more blocks like:
# <Location "/iris3/csp/sys/">
#     CSP On
# </Location>



<VirtualHost *:80>
    DocumentRoot "/src/web"

    <Directory "/src/web">
        Require all granted
        Options FollowSymLinks
        AllowOverride None
    </Directory>
</VirtualHost>